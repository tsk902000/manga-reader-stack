services:
  # --- THE DOWNLOADER ---
  suwayomi:
    image: ghcr.io/suwayomi/suwayomi-server:latest
    container_name: suwayomi
    restart: unless-stopped
    ports:
      - "4567:4567"
    volumes:
      - ./suwayomi/config:/home/suwayomi/.local/share/SuwayomiServer
      - ./manga-library:/home/suwayomi/.local/share/SuwayomiServer/downloads
    environment:
      - TZ=${TZ}
      - SUWAYOMI_SERVER_DOWNLOAD_AS_CBZ=true
    user: "${PUID}:${PGID}"

  # --- THE LIBRARIAN ---
  komga:
    image: gotson/komga:latest
    container_name: komga
    restart: unless-stopped
    ports:
      - "25600:25600"
    volumes:
      - ./komga/config:/config
      - ./manga-library:/data
    environment:
      - TZ=${TZ}
      # Note: Komga uses these for initial setup or internal auth
      - KOMGA_USER=${KOMGA_ADMIN_EMAIL}
      - KOMGA_PASSWORD=${KOMGA_ADMIN_PASSWORD}
    user: "${PUID}:${PGID}"

  # --- THE METADATA FETCHED ---
  komf:
    image: sndxr/komf:latest
    container_name: komf
    restart: unless-stopped
    ports:
      - "8085:8085"
    volumes:
      - ./komf/config:/config
    environment:
      - TZ=${TZ}
      - KOMF_KOMGA_BASE_URL=http://komga:25600
      - KOMF_KOMGA_USER=${KOMGA_ADMIN_EMAIL}
      - KOMF_KOMGA_PASSWORD=${KOMGA_ADMIN_PASSWORD}
    user: "${PUID}:${PGID}"


services:
  # --- THE DOWNLOADER ---
  suwayomi:
    image: ghcr.io/suwayomi/suwayomi-server:latest
    container_name: suwayomi
    restart: unless-stopped
    ports:
      - "4567:4567"
    volumes:
      - ./manga-library:/home/suwayomi/.local/share/Tachidesk/downloads
      - ./suwayomi/files:/home/suwayomi/.local/share/Tachidesk
    environment:
      - TZ=${TZ}
      - SUWAYOMI_SERVER_DOWNLOAD_AS_CBZ=true
      - AUTH_MODE=${SUWAYOMI_AUTH_MODE}
      - AUTH_USERNAME=${ADMIN_EMAIL}
      - AUTH_PASSWORD=${ADMIN_PASSWORD}
      - FLARESOLVERR_ENABLED=true
      - FLARESOLVERR_URL=http://flaresolverr:8191
    user: "${PUID}:${PGID}"

  # --- THE LIBRARIAN ---
  komga:
    image: gotson/komga:latest
    container_name: komga
    restart: unless-stopped
    ports:
      - "25600:25600"
    volumes:
      - ./komga/config:/config
      - ./manga-library:/data
    environment:
      - TZ=${TZ}
      # Note: Komga uses these for initial setup or internal auth
      - KOMGA_USER=${ADMIN_EMAIL}
      - KOMGA_PASSWORD=${ADMIN_PASSWORD}
    user: "${PUID}:${PGID}"

  # --- THE METADATA FETCHED ---
  komf:
    image: sndxr/komf:latest
    container_name: komf
    restart: unless-stopped
    ports:
      - "8085:8085"
    volumes:
      - ./komf/config:/config
    environment:
      - TZ=${TZ}
      - KOMF_KOMGA_BASE_URL=http://komga:25600
      - KOMF_KOMGA_USER=${ADMIN_EMAIL}
      - KOMF_KOMGA_PASSWORD=${ADMIN_PASSWORD}
    user: "${PUID}:${PGID}"

  flaresolverr:
    # DockerHub mirror flaresolverr/flaresolverr:latest
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    environment:
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - LOG_HTML=${LOG_HTML:-false}
      - CAPTCHA_SOLVER=${CAPTCHA_SOLVER:-none}
      - TZ=Europe/London
    ports:
      - "8191:8191"
    restart: unless-stopped 